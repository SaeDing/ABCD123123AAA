<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>íŒŒì¼ ë¹„êµ</title>
  <style>
    /* ê¸°ë³¸ ìŠ¤íƒ€ì¼ */
    body {
      font-family: 'Arial', sans-serif;
      background-color: #f4f4f4;
      margin: 0;
      padding: 0;
      scroll-behavior: smooth;
      transition: background-color 0.3s, color 0.3s;
    }
    /* ë„¤ë¹„ê²Œì´ì…˜ ë°” */
    nav {
      background-color: #333;
      padding: 10px;
      position: fixed;
      top: 0;
      width: 100%;
      z-index: 100;
      text-align: center;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    nav a {
      color: #fff;
      margin: 0 15px;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    /* ì»¨í…Œì´ë„ˆ ì˜ì—­ */
    .container {
      background-color: #fff;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      width: 80%;
      max-width: 800px;
      margin: 80px auto 20px; /* ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ê³ ë ¤ */
      transition: background-color 0.3s, box-shadow 0.3s;
    }
    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 20px;
    }
    .form-group {
      margin-bottom: 20px;
    }
    label {
      display: block;
      margin-bottom: 5px;
      font-weight: bold;
    }
    input[type="file"] {
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    .file-selection-mode {
      display: flex;
      margin-bottom: 10px;
    }
    .mode-option {
      margin-right: 15px;
      cursor: pointer;
    }
    button {
      background-color: #5cb85c;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      width: 100%;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #4cae4c;
    }
    button:focus {
      outline: 2px solid #5cb85c;
      outline-offset: 2px;
    }
    /* ê²€ìƒ‰ì°½ */
    #searchContainer {
      margin: 20px 0;
      text-align: center;
    }
    #searchInput {
      width: 80%;
      padding: 8px;
      font-size: 16px;
      border: 1px solid #ddd;
      border-radius: 4px;
      transition: border-color 0.3s;
    }
    #searchInput:focus {
      border-color: #5cb85c;
      outline: none;
    }
    .result-container {
      margin-top: 30px;
      border-top: 1px solid #eee;
      padding-top: 20px;
    }
    .result-section {
      margin-bottom: 20px;
    }
    .result-section h2 {
      color: #555;
      margin-bottom: 10px;
      display: flex;
      align-items: center;
    }
    .result-section ul {
      list-style-type: none;
      padding: 0;
    }
    .result-section li {
      padding: 8px;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background-color 0.2s;
    }
    .result-section li:hover {
      background-color: #f5f5f5;
    }
    #error {
      color: red;
      font-weight: bold;
    }
    .file-list {
      margin-top: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
      max-height: 150px;
      overflow-y: auto;
    }
    .file-list li {
      list-style: none;
      padding: 5px 0;
      border-bottom: 1px solid #eee;
      cursor: pointer;
      display: flex;
      align-items: center;
      transition: background-color 0.2s;
    }
    .file-list li:hover {
      background-color: #f5f5f5;
    }
    .file-list li:last-child {
      border-bottom: none;
    }
    .thumbnail {
      width: 40px;
      height: auto;
      margin-right: 5px;
      vertical-align: middle;
    }
    /* íŒì—… ê´€ë ¨ */
    .popup {
      display: none;
      position: fixed;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 200;
    }
    .popup-content {
      background-color: white;
      margin: 5% auto;
      padding: 20px;
      border: 1px solid #888;
      width: 80%;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      border-radius: 8px;
      max-height: 90vh;
      transition: background-color 0.3s;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 10px;
      right: 20px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
    }
    /* íŒì—… í—¤ë”: ì¹´í…Œê³ ë¦¬ ì •ë³´ ë° ì¢Œìš° ì´ë™ ë²„íŠ¼ */
    #popup-header {
      width: 100%;
      text-align: center;
      margin-bottom: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #popup-header button {
      background-color: #ddd;
      border: none;
      padding: 5px 10px;
      margin: 0 10px;
      font-size: 18px;
      cursor: pointer;
      border-radius: 4px;
      width: auto;
      color: #333;
    }
    #popup-header button:hover {
      background-color: #ccc;
    }
    #popup-category-label {
      font-weight: bold;
      font-size: 16px;
    }
    .preview-container {
      display: flex;
      flex-direction: row;
      justify-content: space-around;
      width: 100%;
    }
    .preview {
      flex: 1;
      margin: 5px;
      overflow: auto;
      max-height: 80vh;
      border: 1px solid #ddd;
      border-radius: 4px;
      padding: 10px;
    }
    .preview-title {
      font-weight: bold;
      text-align: center;
      margin-bottom: 10px;
      padding-bottom: 5px;
      border-bottom: 1px solid #eee;
    }
    /* .bin ë¯¸ë¦¬ë³´ê¸° í°íŠ¸ í¬ê¸° ì¦ê°€ */
    pre {
      white-space: pre-wrap;
      word-wrap: break-word;
      max-height: 80vh;
      overflow-y: auto;
      font-size: 16px;
      line-height: 1.5;
    }
    /* í´ë” ëª¨ë“œ ì„ íƒ ê´€ë ¨ ìŠ¤íƒ€ì¼ */
    .file-mode-selector {
      display: flex;
      margin-bottom: 10px;
    }
    .file-mode-selector label {
      margin-right: 15px;
      display: flex;
      align-items: center;
      font-weight: normal;
    }
    .file-mode-selector input {
      margin-right: 5px;
    }
    .files-counter {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
    }
    
    /* ë¡œë”© ì¸ë””ì¼€ì´í„° ìŠ¤íƒ€ì¼ */
    .loading {
      display: none;
      text-align: center;
      margin: 20px 0;
    }
    
    .loading-spinner {
      border: 4px solid #f3f3f3;
      border-top: 4px solid #5cb85c;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto;
    }
    
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    
    /* ì•Œë¦¼ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
    .alert {
      padding: 10px 15px;
      margin: 15px 0;
      border-radius: 4px;
      display: none;
    }
    
    .alert-success {
      background-color: #dff0d8;
      color: #3c763d;
      border: 1px solid #d6e9c6;
    }
    
    .alert-info {
      background-color: #d9edf7;
      color: #31708f;
      border: 1px solid #bce8f1;
    }
    
    .alert-error {
      background-color: #f2dede;
      color: #a94442;
      border: 1px solid #ebccd1;
    }
    
    /* ì •ë ¬ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .sort-btn {
      background: none;
      border: none;
      cursor: pointer;
      margin-left: 5px;
      font-size: 14px;
      color: #666;
      padding: 2px 5px;
      width: auto;
    }
    
    .sort-btn:hover {
      color: #333;
      background-color: #eee;
      border-radius: 3px;
    }
    
    /* ë¹„êµ ê²°ê³¼ ìƒíƒœ ë°°ì§€ */
    .status-badge {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 12px;
      font-size: 12px;
      margin-left: 5px;
    }
    
    .changed-badge {
      background-color: #fcf8e3;
      color: #8a6d3b;
    }
    
    .new-badge {
      background-color: #dff0d8;
      color: #3c763d;
    }
    
    .deleted-badge {
      background-color: #f2dede;
      color: #a94442;
    }
    
    .identical-badge {
      background-color: #d9edf7;
      color: #31708f;
    }
    
    /* íŒŒì¼ í˜•ì‹ í•„í„° */
    .file-filter {
      margin: 15px 0;
      display: flex;
      align-items: center;
    }
    
    .file-filter label {
      margin-right: 10px;
      display: inline-block;
    }
    
    .file-filter select {
      padding: 5px;
      border-radius: 4px;
      border: 1px solid #ddd;
    }
    
    /* ë‚´ìš© ë¹„êµ ëª¨ë“œ í† ê¸€ */
    .comparison-mode {
      margin: 15px 0;
    }
    
    /* ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ */
    .export-section {
      margin: 20px 0;
    }
    
    /* í•˜ì´ë¼ì´íŠ¸ ì½”ë“œ - ë‹¤ë¥¸ ë¶€ë¶„ */
    .diff-highlight {
      background-color: #ffdddd;
      color: #a94442;
    }
    
    /* ë‹¤í¬ ëª¨ë“œ í† ê¸€ ìŠ¤íƒ€ì¼ */
    .theme-toggle {
      position: absolute;
      top: 10px;
      right: 15px;
      background: none;
      border: none;
      color: white;
      cursor: pointer;
      font-size: 16px;
      z-index: 101;
      width: auto;
      padding: 5px 10px;
    }
    
    /* ë‹¤í¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ */
    body.dark-mode {
      background-color: #222;
      color: #eee;
    }
    
    body.dark-mode .container {
      background-color: #333;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    }
    
    body.dark-mode h1, body.dark-mode h2 {
      color: #fff;
    }
    
    body.dark-mode input, body.dark-mode select {
      background-color: #444;
      color: #eee;
      border-color: #555;
    }
    
    body.dark-mode .file-list, body.dark-mode .result-section li {
      background-color: #444;
      border-color: #555;
      color: #eee;
    }
    
    body.dark-mode .file-list li, body.dark-mode .result-section li {
      border-color: #555;
    }
    
    body.dark-mode .file-list li:hover, body.dark-mode .result-section li:hover {
      background-color: #555;
    }
    
    body.dark-mode .popup-content {
      background-color: #333;
      color: #eee;
      border-color: #555;
    }
    
    body.dark-mode .preview {
      border-color: #555;
      background-color: #444;
    }
    
    body.dark-mode .preview-title {
      border-color: #555;
    }
    
    body.dark-mode pre {
      color: #eee;
    }
    
    body.dark-mode .close {
      color: #ddd;
    }
    
    body.dark-mode .diff-highlight {
      background-color: #553333;
      color: #ffdddd;
    }
    
    body.dark-mode .alert-success {
      background-color: #254525;
      color: #9fd99f;
      border-color: #1e3e1e;
    }
    
    body.dark-mode .alert-info {
      background-color: #254055;
      color: #9fc4d9;
      border-color: #1e3c4e;
    }
    
    body.dark-mode .alert-error {
      background-color: #552525;
      color: #d99f9f;
      border-color: #3e1e1e;
    }
    
    /* ë°˜ì‘í˜• ë””ìì¸ ê°œì„  */
    @media (max-width: 768px) {
      .container {
        width: 95%;
        padding: 15px;
      }
      
      .preview-container {
        flex-direction: column;
      }
      
      .preview {
        margin: 10px 0;
      }
      
      nav {
        overflow-x: auto;
        white-space: nowrap;
      }
      
      nav a {
        display: inline-block;
        margin: 0 10px;
      }
      
      /* ëª¨ë°”ì¼ì—ì„œ íŒì—… ì¡°ì • */
      .popup-content {
        width: 95%;
        margin: 2% auto;
      }
    }
    
    /* í…ìŠ¤íŠ¸ ë¹„êµ ê°•ì¡° íš¨ê³¼ */
    .line-diff {
      background-color: #ffecec;
    }
    
    body.dark-mode .line-diff {
      background-color: #4c3030;
    }
    
    /* íŒŒì¼ ì„¹ì…˜ í—¤ë” */
    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    
    .clear-files {
      background-color: #f44336;
      color: white;
      padding: 5px 10px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 12px;
      width: auto;
    }
    
    .clear-files:hover {
      background-color: #d32f2f;
    }
    
    /* ìŠ¤í¬ë¡¤ íƒ‘ ë²„íŠ¼ */
    .scroll-top {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #5cb85c;
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      text-align: center;
      line-height: 40px;
      cursor: pointer;
      display: none;
      opacity: 0.7;
      z-index: 99;
      font-size: 20px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
    }
    
    .scroll-top:hover {
      opacity: 1;
    }
    
    /* í†µê³„ ì •ë³´ */
    .stats-container {
      background-color: #f9f9f9;
      border-radius: 4px;
      padding: 15px;
      margin: 15px 0;
      border: 1px solid #eee;
    }
    
    body.dark-mode .stats-container {
      background-color: #444;
      border-color: #555;
    }
    
    .stats-title {
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 10px;
    }
    
    .stat-item {
      display: flex;
      justify-content: space-between;
    }
    
    .stat-label {
      color: #666;
    }
    
    body.dark-mode .stat-label {
      color: #aaa;
    }
    
    .stat-value {
      font-weight: bold;
    }
  </style>
</head>
<body>
  <!-- ìƒë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
  <nav>
    <a href="#top">ë§¨ìœ„ë¡œ</a>
    <a href="#changedResult">í¬ê¸°ê°€ ë³€í™”í•œ íŒŒì¼</a>
    <a href="#newResult">ìƒˆë¡œ ìƒê¸´ íŒŒì¼</a>
    <a href="#deletedResult">ì—†ì–´ì§„ íŒŒì¼</a>
    <a href="#identicalResult">ë™ì¼í•œ íŒŒì¼</a>
  </nav>
  
  <!-- ë‹¤í¬ ëª¨ë“œ í† ê¸€ ë²„íŠ¼ -->
  <button id="theme-toggle" class="theme-toggle">ğŸŒ™ / â˜€ï¸</button>
  
  <!-- ìµœìƒë‹¨ ì•µì»¤ -->
  <div id="top"></div>
  
  <div class="container">
    <h1>íŒŒì¼ ë¹„êµ</h1>
    
    <!-- ì•Œë¦¼ ë©”ì‹œì§€ ì»¨í…Œì´ë„ˆ -->
    <div id="alert-success" class="alert alert-success"></div>
    <div id="alert-info" class="alert alert-info"></div>
    <div id="alert-error" class="alert alert-error"></div>
    
    <div id="fileA-section" class="form-group">
      <div class="section-header">
        <label for="fileA">íŒŒì¼ A ì„ íƒ: íŒ¨ì¹˜ì „</label>
        <button class="clear-files" id="clear-fileA">ì´ˆê¸°í™”</button>
      </div>
      <div class="file-mode-selector">
        <label><input type="radio" name="fileAMode" value="files" checked> íŒŒì¼ ì„ íƒ</label>
        <label><input type="radio" name="fileAMode" value="folder"> í´ë” ì„ íƒ</label>
      </div>
      <input type="file" id="fileA" multiple>
      <div class="files-counter" id="fileACounter"></div>
      <ul id="fileA-list" class="file-list"></ul>
    </div>
    
    <div id="fileB-section" class="form-group">
      <div class="section-header">
        <label for="fileB">íŒŒì¼ B ì„ íƒ: íŒ¨ì¹˜í›„</label>
        <button class="clear-files" id="clear-fileB">ì´ˆê¸°í™”</button>
      </div>
      <div class="file-mode-selector">
        <label><input type="radio" name="fileBMode" value="files" checked> íŒŒì¼ ì„ íƒ</label>
        <label><input type="radio" name="fileBMode" value="folder"> í´ë” ì„ íƒ</label>
      </div>
      <input type="file" id="fileB" multiple>
      <div class="files-counter" id="fileBCounter"></div>
      <ul id="fileB-list" class="file-list"></ul>
    </div>
    
    <!-- ë‚´ìš© ë¹„êµ ëª¨ë“œ í† ê¸€ -->
    <div class="comparison-mode">
      <label><input type="checkbox" id="content-comparison" checked> ê°€ëŠ¥í•œ ê²½ìš° ë‚´ìš© ë¹„êµí•˜ê¸°</label>
    </div>
    
    <!-- ë¡œë”© ì¸ë””ì¼€ì´í„° -->
    <div id="loading" class="loading">
      <div class="loading-spinner"></div>
      <p>íŒŒì¼ ì²˜ë¦¬ ì¤‘...</p>
    </div>
    
    <button id="compare-button" onclick="compareFiles()">ë¹„êµí•˜ê¸°</button>
    
    <!-- ê²€ìƒ‰ ê¸°ëŠ¥: ì…ë ¥í•˜ëŠ”ëŒ€ë¡œ ê²°ê³¼ ì˜ì—­ì˜ íŒŒì¼ë“¤ í•„í„°ë§ -->
    <div id="searchContainer">
      <input type="text" id="searchInput" placeholder="íŒŒì¼ëª… ê²€ìƒ‰">
    </div>
    
    <!-- íŒŒì¼ í˜•ì‹ í•„í„° -->
    <div class="file-filter">
      <label>íŒŒì¼ í˜•ì‹ í•„í„°:</label>
      <select id="file-type-filter">
        <option value="all">ëª¨ë“  íŒŒì¼</option>
        <option value="png">ì´ë¯¸ì§€ íŒŒì¼</option>
        <option value="bin">BIN íŒŒì¼</option>
        <option value="other">ê¸°íƒ€ íŒŒì¼</option>
      </select>
    </div>
    
    <!-- í†µê³„ ì •ë³´ ì„¹ì…˜ -->
    <div id="stats-container" class="stats-container" style="display: none;">
      <div class="stats-title">ë¹„êµ í†µê³„</div>
      <div class="stats-grid">
        <div class="stat-item">
          <span class="stat-label">ì´ íŒŒì¼ ìˆ˜ (A):</span>
          <span class="stat-value" id="stat-total-a">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ì´ íŒŒì¼ ìˆ˜ (B):</span>
          <span class="stat-value" id="stat-total-b">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ë³€ê²½ëœ íŒŒì¼:</span>
          <span class="stat-value" id="stat-changed">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ìƒˆë¡œìš´ íŒŒì¼:</span>
          <span class="stat-value" id="stat-new">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ì‚­ì œëœ íŒŒì¼:</span>
          <span class="stat-value" id="stat-deleted">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">ë™ì¼í•œ íŒŒì¼:</span>
          <span class="stat-value" id="stat-identical">0</span>
        </div>
      </div>
    </div>
    
    <!-- ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ -->
    <div class="export-section" style="display: none;" id="export-section">
      <button id="export-btn">ë¹„êµ ê²°ê³¼ ë‹¤ìš´ë¡œë“œ</button>
    </div>
    
    <div id="result" class="result-container">
      <div id="changedResult" class="result-section">
        <h2>
          í¬ê¸°ê°€ ë³€í™”í•œ íŒŒì¼
          <button class="sort-btn" data-sort="name" data-list="changedList">ì´ë¦„ìˆœ</button>
          <button class="sort-btn" data-sort="size" data-list="changedList">í¬ê¸°ìˆœ</button>
        </h2>
        <ul id="changedList"></ul>
      </div>
      <div id="newResult" class="result-section">
        <h2>
          ìƒˆë¡œ ìƒê¸´ íŒŒì¼
          <button class="sort-btn" data-sort="name" data-list="newList">ì´ë¦„ìˆœ</button>
          <button class="sort-btn" data-sort="size" data-list="newList">í¬ê¸°ìˆœ</button>
        </h2>
        <ul id="newList"></ul>
      </div>
      <div id="deletedResult" class="result-section">
        <h2>
          ì—†ì–´ì§„ íŒŒì¼
          <button class="sort-btn" data-sort="name" data-list="deletedList">ì´ë¦„ìˆœ</button>
          <button class="sort-btn" data-sort="size" data-list="deletedList">í¬ê¸°ìˆœ</button>
        </h2>
        <ul id="deletedList"></ul>
      </div>
      <div id="identicalResult" class="result-section">
        <h2>
          ë™ì¼í•œ íŒŒì¼
          <button class="sort-btn" data-sort="name" data-list="identicalList">ì´ë¦„ìˆœ</button>
          <button class="sort-btn" data-sort="size" data-list="identicalList">í¬ê¸°ìˆœ</button>
        </h2>
        <ul id="identicalList"></ul>
      </div>
    </div>
    <div id="error"></div>
  </div>
  
  <!-- íŒì—… ì˜ì—­ -->
  <div id="popup" class="popup">
    <div class="popup-content">
      <span class="close">&times;</span>
      <!-- íŒì—… í—¤ë”: ì¢Œìš° ë²„íŠ¼ ë° ì¹´í…Œê³ ë¦¬ í‘œì‹œ -->
      <div id="popup-header">
        <button id="prevBtn">&lt;</button>
        <span id="popup-category-label"></span>
        <button id="nextBtn">&gt;</button>
      </div>
      <div class="preview-container">
        <div id="previewA" class="preview">
          <div class="preview-title">íŒ¨ì¹˜ ì „ (A)</div>
          <div id="previewA-content"></div>
        </div>
        <div id="previewB" class="preview">
          <div class="preview-title">íŒ¨ì¹˜ í›„ (B)</div>
          <div id="previewB-content"></div>
        </div>
      </div>
    </div>
  </div>
  
  <!-- ë§¨ ìœ„ë¡œ ìŠ¤í¬ë¡¤ ë²„íŠ¼ -->
  <div class="scroll-top" id="scroll-top">â†‘</div>
  
  <script>
    /**********************
     * ì „ì—­ ë³€ìˆ˜ ì„ ì–¸
     **********************/
    const fileAInput = document.getElementById('fileA');
    const fileBInput = document.getElementById('fileB');
    const fileAList = document.getElementById('fileA-list');
    const fileBList = document.getElementById('fileB-list');
    const fileACounter = document.getElementById('fileACounter');
    const fileBCounter = document.getElementById('fileBCounter');
    const compareButton = document.getElementById('compare-button');
    const exportSection = document.getElementById('export-section');
    const statsContainer = document.getElementById('stats-container');
    const contentComparisonCheckbox = document.getElementById('content-comparison');
    const scrollTopButton = document.getElementById('scroll-top');
    
    // íŒŒì¼ë³„ ì •ë³´ë¥¼ ì €ì¥ (í¬ê¸°, ë¯¸ë¦¬ë³´ê¸° ë°ì´í„° ë“±)
    let fileASizes = {};
    let fileBSizes = {};
    
    // ì¹´í…Œê³ ë¦¬ë³„ ë¦¬ìŠ¤íŠ¸ ë°ì´í„°ë¥¼ ì „ì—­ìœ¼ë¡œ ì €ì¥ (íŒŒì¼ëª… ë°°ì—´)
    let categoryData = {
      changed: [],
      new: [],
      deleted: [],
      identical: []
    };
    
    // íŒì—… ë‚´ í˜„ì¬ ì¹´í…Œê³ ë¦¬ ë° ì¸ë±ìŠ¤ ì €ì¥
    let currentPreviewCategory = "";
    let currentPreviewIndex = 0;
    // ì¹´í…Œê³ ë¦¬ ìˆœì„œ (ê±´ë„ˆë›°ê¸° ìœ„í•œ ìˆœì„œ)
    const categoryOrder = ["changed", "new", "deleted", "identical"];
    
    // ì¹´í…Œê³ ë¦¬ë³„ í‘œì‹œëª…
    const categoryNames = {
      changed: "í¬ê¸°ê°€ ë³€í™”í•œ íŒŒì¼",
      new: "ìƒˆë¡œ ìƒê¸´ íŒŒì¼",
      deleted: "ì—†ì–´ì§„ íŒŒì¼",
      identical: "ë™ì¼í•œ íŒŒì¼"
    };
    
    /**********************
     * ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
     **********************/
    
    // ë¡œë”© ìƒíƒœ ê´€ë¦¬
    function showLoading() {
      document.getElementById('loading').style.display = 'block';
      compareButton.disabled = true;
    }
    
    function hideLoading() {
      document.getElementById('loading').style.display = 'none';
      compareButton.disabled = false;
    }
    
    // ì•Œë¦¼ ë©”ì‹œì§€ í‘œì‹œ
    function showAlert(type, message, duration = 3000) {
      const alertElement = document.getElementById(`alert-${type}`);
      alertElement.textContent = message;
      alertElement.style.display = 'block';
      
      setTimeout(() => {
        alertElement.style.display = 'none';
      }, duration);
    }
    
    // íŒŒì¼ í¬ê¸° í¬ë§·íŒ… (ë°”ì´íŠ¸ -> KB, MB)
    function formatFileSize(bytes) {
      if (bytes < 1024) {
        return bytes + ' B';
      } else if (bytes < 1024 * 1024) {
        return (bytes / 1024).toFixed(2) + ' KB';
      } else {
        return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
      }
    }
    
    // í…ìŠ¤íŠ¸ì—ì„œ íŒŒì¼ í¬ê¸° ì¶”ì¶œ (KB ë‹¨ìœ„)
    function extractFileSize(text) {
      const match = text.match(/(\d+(\.\d+)?)KB/);
      return match ? parseFloat(match[1]) : 0;
    }
    
    // í…ìŠ¤íŠ¸ ë¼ì¸ë³„ ì°¨ì´ ì°¾ê¸°
    function findDifferentLines(textA, textB) {
      if (!textA || !textB) return { diffLines: [] };
      
      const linesA = textA.split('\n');
      const linesB = textB.split('\n');
      const diffLines = [];
      
      const maxLen = Math.max(linesA.length, linesB.length);
      
      for (let i = 0; i < maxLen; i++) {
        if (i >= linesA.length || i >= linesB.length || linesA[i] !== linesB[i]) {
          diffLines.push(i);
        }
      }
      
      return { 
        isDifferent: diffLines.length > 0,
        diffLines: diffLines,
        linesA: linesA,
        linesB: linesB
      };
    }
    
    // ìŠ¤í¬ë¡¤ ì´ë²¤íŠ¸ ì²˜ë¦¬
    window.addEventListener('scroll', () => {
      if (window.scrollY > 300) {
        scrollTopButton.style.display = 'block';
      } else {
        scrollTopButton.style.display = 'none';
      }
    });
    
    scrollTopButton.addEventListener('click', () => {
      window.scrollTo({
        top: 0,
        behavior: 'smooth'
      });
    });
    
    /**********************
     * íŒŒì¼/í´ë” ì„ íƒ ëª¨ë“œ ë³€ê²½ ì²˜ë¦¬
     **********************/
    
    // íŒŒì¼ A ëª¨ë“œ ì„ íƒ ì²˜ë¦¬
    document.querySelectorAll('input[name="fileAMode"]').forEach(radio => {
      radio.addEventListener('change', function() {
        updateFileInputMode(fileAInput, this.value === 'folder');
      });
    });
    
    // íŒŒì¼ B ëª¨ë“œ ì„ íƒ ì²˜ë¦¬
    document.querySelectorAll('input[name="fileBMode"]').forEach(radio => {
      radio.addEventListener('change', function() {
        updateFileInputMode(fileBInput, this.value === 'folder');
      });
    });
    
    // íŒŒì¼ ì…ë ¥ ëª¨ë“œ ì—…ë°ì´íŠ¸
    function updateFileInputMode(inputElement, isFolderMode) {
      if (isFolderMode) {
        inputElement.setAttribute('webkitdirectory', '');
        inputElement.setAttribute('directory', '');
      } else {
        inputElement.removeAttribute('webkitdirectory');
        inputElement.removeAttribute('directory');
      }
      // íŒŒì¼ ì„ íƒ ì´ˆê¸°í™”
      clearFileInput(inputElement);
    }
    
    // íŒŒì¼ ì…ë ¥ ì´ˆê¸°í™”
    function clearFileInput(inputElement) {
      inputElement.value = '';
      if (inputElement === fileAInput) {
        fileASizes = {};
        fileAList.innerHTML = '';
        fileACounter.textContent = '';
      } else {
        fileBSizes = {};
        fileBList.innerHTML = '';
        fileBCounter.textContent = '';
      }
    }
    
    // ì´ˆê¸°í™” ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('clear-fileA').addEventListener('click', () => {
      clearFileInput(fileAInput);
    });
    
    document.getElementById('clear-fileB').addEventListener('click', () => {
      clearFileInput(fileBInput);
    });
    
    /**********************
     * íŒŒì¼ ì„ íƒ ì²˜ë¦¬
     **********************/
    fileAInput.addEventListener('change', (event) => {
      fileASizes = {};
      fileAList.innerHTML = "";
      const files = event.target.files;
      fileACounter.textContent = `ì´ ${files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
      
      for (let file of files) {
        // í´ë” ëª¨ë“œì¼ ê²½ìš° ê²½ë¡œ í¬í•¨ íŒŒì¼ëª… ì‚¬ìš©
        const filePath = file.webkitRelativePath || file.name;
        fileASizes[filePath] = { size: file.size, path: filePath };
        
        let liElem = document.createElement('li');
        let nameSpan = document.createElement('span');
        nameSpan.textContent = `${filePath} (${formatFileSize(file.size)})`;
        liElem.appendChild(nameSpan);
        
        // png íŒŒì¼ì´ë©´ ì¸ë„¤ì¼ ìƒì„±
        if (file.type === "image/png" || file.type === "image/jpeg" || file.type === "image/gif") {
          fileASizes[filePath]["type"] = "image";
          const reader = new FileReader();
          reader.onload = (e) => {
            fileASizes[filePath]["dataUrl"] = e.target.result;
            const thumb = document.createElement('img');
            thumb.src = e.target.result;
            thumb.className = "thumbnail";
            liElem.insertBefore(thumb, nameSpan);
          };
          reader.readAsDataURL(file);
          liElem.style.cursor = "pointer";
        }
        // .bin íŒŒì¼ì´ë‚˜ í…ìŠ¤íŠ¸ íŒŒì¼ì´ë©´ í…ìŠ¤íŠ¸ ì½ê¸°
        else if (file.name.toLowerCase().endsWith(".bin") || 
                file.name.toLowerCase().endsWith(".txt") || 
                file.name.toLowerCase().endsWith(".csv") || 
                file.name.toLowerCase().endsWith(".json") || 
                file.name.toLowerCase().endsWith(".html") || 
                file.name.toLowerCase().endsWith(".css") || 
                file.name.toLowerCase().endsWith(".xml") ||
                file.name.toLowerCase().endsWith(".prof") || 
                file.name.toLowerCase().endsWith(".vdex") ||
                file.name.toLowerCase().endsWith(".js")) {
          fileASizes[filePath]["type"] = "text";
          const reader = new FileReader();
          reader.onload = (e) => {
            fileASizes[filePath]["data"] = e.target.result;
          };
          reader.readAsText(file);
          liElem.style.cursor = "pointer";
        }
        fileAList.appendChild(liElem);
      }
      
      // í†µê³„ ì—…ë°ì´íŠ¸
      updateStatistics();
    });
    
    fileBInput.addEventListener('change', (event) => {
      fileBSizes = {};
      fileBList.innerHTML = "";
      const files = event.target.files;
      fileBCounter.textContent = `ì´ ${files.length}ê°œ íŒŒì¼ ì„ íƒë¨`;
      
      for (let file of files) {
        // í´ë” ëª¨ë“œì¼ ê²½ìš° ê²½ë¡œ í¬í•¨ íŒŒì¼ëª… ì‚¬ìš©
        const filePath = file.webkitRelativePath || file.name;
        fileBSizes[filePath] = { size: file.size, path: filePath };
        
        let liElem = document.createElement('li');
        let nameSpan = document.createElement('span');
        nameSpan.textContent = `${filePath} (${formatFileSize(file.size)})`;
        liElem.appendChild(nameSpan);
        
        if (file.type === "image/png" || file.type === "image/jpeg" || file.type === "image/gif") {
          fileBSizes[filePath]["type"] = "image";
          const reader = new FileReader();
          reader.onload = (e) => {
            fileBSizes[filePath]["dataUrl"] = e.target.result;
            const thumb = document.createElement('img');
            thumb.src = e.target.result;
            thumb.className = "thumbnail";
            liElem.insertBefore(thumb, nameSpan);
          };
          reader.readAsDataURL(file);
          liElem.style.cursor = "pointer";
        } else if (file.name.toLowerCase().endsWith(".bin") || 
                  file.name.toLowerCase().endsWith(".txt") || 
                  file.name.toLowerCase().endsWith(".csv") || 
                  file.name.toLowerCase().endsWith(".json") || 
                  file.name.toLowerCase().endsWith(".html") || 
                  file.name.toLowerCase().endsWith(".css") || 
                  file.name.toLowerCase().endsWith(".xml") ||
                  file.name.toLowerCase().endsWith(".prof") || 
                  file.name.toLowerCase().endsWith(".vdex") ||
                  file.name.toLowerCase().endsWith(".js")) {
          fileBSizes[filePath]["type"] = "text";
          const reader = new FileReader();
          reader.onload = (e) => {
            fileBSizes[filePath]["data"] = e.target.result;
          };
          reader.readAsText(file);
          liElem.style.cursor = "pointer";
        }
        fileBList.appendChild(liElem);
      }
      
      // í†µê³„ ì—…ë°ì´íŠ¸
      updateStatistics();
    });
    
    // í†µê³„ ì •ë³´ ì—…ë°ì´íŠ¸
    function updateStatistics() {
      document.getElementById('stat-total-a').textContent = Object.keys(fileASizes).length;
      document.getElementById('stat-total-b').textContent = Object.keys(fileBSizes).length;
      
      // ë¹„êµ ì™„ë£Œ í›„ë¼ë©´ ë‹¤ë¥¸ í†µê³„ë„ ì—…ë°ì´íŠ¸
      if (categoryData.changed.length > 0 || 
          categoryData.new.length > 0 || 
          categoryData.deleted.length > 0 || 
          categoryData.identical.length > 0) {
        document.getElementById('stat-changed').textContent = categoryData.changed.length;
        document.getElementById('stat-new').textContent = categoryData.new.length;
        document.getElementById('stat-deleted').textContent = categoryData.deleted.length;
        document.getElementById('stat-identical').textContent = categoryData.identical.length;
        statsContainer.style.display = 'block';
      }
    }
    
    /**********************
     * íŒŒì¼ ë¹„êµ ë° ë¦¬ìŠ¤íŠ¸ ìƒì„±
     **********************/
    function compareFiles() {
      const changedList = document.getElementById('changedList');
      const newList = document.getElementById('newList');
      const deletedList = document.getElementById('deletedList');
      const identicalList = document.getElementById('identicalList');
      const error = document.getElementById('error');
      
      changedList.innerHTML = '';
      newList.innerHTML = '';
      deletedList.innerHTML = '';
      identicalList.innerHTML = '';
      error.innerHTML = '';
      
      if(Object.keys(fileASizes).length === 0 || Object.keys(fileBSizes).length === 0){
        showAlert('error', "ë‘ ê°œì˜ íŒŒì¼ ëª©ë¡ ëª¨ë‘ ì„ íƒí•´ì£¼ì„¸ìš”.");
        return;
      }
      
      showLoading();
      
      // ë¹„ë™ê¸° ì²˜ë¦¬ë¥¼ ìœ„í•´ setTimeout ì‚¬ìš©
      setTimeout(() => {
        try {
          let changed = [];
          let newFiles = [];
          let deletedFiles = [];
          let identical = [];
          
          const allFiles = new Set([...Object.keys(fileASizes), ...Object.keys(fileBSizes)]);
          
          allFiles.forEach(file => {
            const sizeA = fileASizes[file]?.size || 0;
            const sizeB = fileBSizes[file]?.size || 0;
            if(fileASizes[file] && fileBSizes[file]) {
              if(sizeA !== sizeB) {
                changed.push(file);
              } else {
                // ë‚´ìš© ë¹„êµê°€ í™œì„±í™”ë˜ì–´ ìˆê³  í…ìŠ¤íŠ¸ íŒŒì¼ì¸ ê²½ìš° ë‚´ìš© ë¹„êµ
                if (contentComparisonCheckbox.checked && 
                    fileASizes[file].type === 'text' && 
                    fileBSizes[file].type === 'text') {
                  const contentA = fileASizes[file].data;
                  const contentB = fileBSizes[file].data;
                  
                  if (contentA !== contentB) {
                    changed.push(file);
                  } else {
                    identical.push(file);
                  }
                } else {
                  identical.push(file);
                }
              }
            } else if(!fileASizes[file] && fileBSizes[file]){
              newFiles.push(file);
            } else if(fileASizes[file] && !fileBSizes[file]){
              deletedFiles.push(file);
            }
          });
          
          // ì „ì—­ ë³€ìˆ˜ì— ê° ì¹´í…Œê³ ë¦¬ ì €ì¥
          categoryData.changed = changed;
          categoryData.new = newFiles;
          categoryData.deleted = deletedFiles;
          categoryData.identical = identical;
          
          // changed ë¦¬ìŠ¤íŠ¸ ìƒì„±
          changed.forEach((file, idx) => {
            const sizeA = fileASizes[file].size;
            const sizeB = fileBSizes[file].size;
            const sizeA_formatted = formatFileSize(sizeA);
            const sizeB_formatted = formatFileSize(sizeB);
            const diff = Math.abs(sizeA - sizeB);
            const diff_formatted = formatFileSize(diff);
            
            let li = document.createElement('li');
            li.textContent = `${file} (${sizeA_formatted} â†’ ${sizeB_formatted}) ì°¨ì´: ${diff_formatted}`;
            
            // ìƒíƒœ ë°°ì§€ ì¶”ê°€
            const badge = document.createElement('span');
            badge.className = 'status-badge changed-badge';
            badge.textContent = 'ë³€ê²½ë¨';
            li.appendChild(badge);
            
            li.style.cursor = "pointer";
            
            if(fileASizes[file]?.type === "image") {
              const thumbA = document.createElement('img');
              thumbA.src = fileASizes[file].dataUrl;
              thumbA.className = "thumbnail";
              li.appendChild(thumbA);
            }
            if(fileBSizes[file]?.type === "image") {
              const thumbB = document.createElement('img');
              thumbB.src = fileBSizes[file].dataUrl;
              thumbB.className = "thumbnail";
              li.appendChild(thumbB);
            }
            li.dataset.category = "changed";
            li.dataset.index = idx;
            changedList.appendChild(li);
          });
          
          // new ë¦¬ìŠ¤íŠ¸ ìƒì„±
          newFiles.forEach((file, idx) => {
            const sizeB = fileBSizes[file].size;
            const sizeB_formatted = formatFileSize(sizeB);
            
            let li = document.createElement('li');
            li.textContent = `${file} (0B â†’ ${sizeB_formatted})`;
            
            // ìƒíƒœ ë°°ì§€ ì¶”ê°€
            const badge = document.createElement('span');
            badge.className = 'status-badge new-badge';
            badge.textContent = 'ì‹ ê·œ';
            li.appendChild(badge);
            
            li.style.cursor = "pointer";
            
            if(fileBSizes[file]?.type === "image") {
              const thumb = document.createElement('img');
              thumb.src = fileBSizes[file].dataUrl;
              thumb.className = "thumbnail";
              li.insertBefore(thumb, li.firstChild);
            }
            li.dataset.category = "new";
            li.dataset.index = idx;
            newList.appendChild(li);
          });
          
          // deleted ë¦¬ìŠ¤íŠ¸ ìƒì„±
          deletedFiles.forEach((file, idx) => {
            const sizeA = fileASizes[file].size;
            const sizeA_formatted = formatFileSize(sizeA);
            
            let li = document.createElement('li');
            li.textContent = `${file} (${sizeA_formatted} â†’ 0B)`;
            
            // ìƒíƒœ ë°°ì§€ ì¶”ê°€
            const badge = document.createElement('span');
            badge.className = 'status-badge deleted-badge';
            badge.textContent = 'ì‚­ì œë¨';
            li.appendChild(badge);
            
            li.style.cursor = "pointer";
            
            if(fileASizes[file]?.type === "image") {
              const thumb = document.createElement('img');
              thumb.src = fileASizes[file].dataUrl;
              thumb.className = "thumbnail";
              li.insertBefore(thumb, li.firstChild);
            }
            li.dataset.category = "deleted";
            li.dataset.index = idx;
            deletedList.appendChild(li);
          });
          
          // identical ë¦¬ìŠ¤íŠ¸ ìƒì„±
          identical.forEach((file, idx) => {
            const size = fileASizes[file].size;
            const size_formatted = formatFileSize(size);
            
            let li = document.createElement('li');
            li.textContent = `${file} (${size_formatted})`;
            
            // ìƒíƒœ ë°°ì§€ ì¶”ê°€
            const badge = document.createElement('span');
            badge.className = 'status-badge identical-badge';
            badge.textContent = 'ë™ì¼';
            li.appendChild(badge);
            
            li.style.cursor = "pointer";
            
            if(fileASizes[file]?.type === "image") {
              const thumb = document.createElement('img');
              thumb.src = fileASizes[file].dataUrl;
              thumb.className = "thumbnail";
              li.insertBefore(thumb, li.firstChild);
            }
            li.dataset.category = "identical";
            li.dataset.index = idx;
            identicalList.appendChild(li);
          });
          
          // ë¹„êµ ì™„ë£Œ ë©”ì‹œì§€ í‘œì‹œ
          showAlert('success', 'íŒŒì¼ ë¹„êµê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
          
          // ê²°ê³¼ê°€ ì—†ëŠ” ì¹´í…Œê³ ë¦¬ ì²˜ë¦¬
          for (const category in categoryData) {
            if (categoryData[category].length === 0) {
              document.getElementById(`${category}Result`).style.display = 'none';
            } else {
              document.getElementById(`${category}Result`).style.display = 'block';
            }
          }
          
          // í†µê³„ í‘œì‹œ
          updateStatistics();
          statsContainer.style.display = 'block';
          
          // ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ë²„íŠ¼ í‘œì‹œ
          exportSection.style.display = 'block';
          
          // ë¹„êµ í›„ ê²€ìƒ‰ í•„í„° ì ìš© (ê²€ìƒ‰ì°½ ì…ë ¥ê°’ì´ ìˆìœ¼ë©´)
          filterResults();
          
          hideLoading();
        } catch (error) {
          console.error(error);
          document.getElementById('error').innerHTML = `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`;
          showAlert('error', `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
          hideLoading();
        }
      }, 100);
    }
    
    /**********************
     * ê²€ìƒ‰ í•„í„° ê¸°ëŠ¥
     **********************/
    const searchInput = document.getElementById("searchInput");
    searchInput.addEventListener("input", filterResults);
    
    function filterResults() {
      const query = searchInput.value.trim().toLowerCase();
      const fileTypeFilter = document.getElementById('file-type-filter').value;
      
      // ë„¤ ê°œì˜ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ id ë°°ì—´
      const listIds = ["changedList", "newList", "deletedList", "identicalList"];
      listIds.forEach(id => {
        const ul = document.getElementById(id);
        const items = ul.getElementsByTagName("li");
        for(let i = 0; i < items.length; i++){
          const text = items[i].textContent.toLowerCase();
          const filePath = items[i].dataset.index ? categoryData[items[i].dataset.category][items[i].dataset.index] : '';
          
          // íŒŒì¼ëª… ê²€ìƒ‰ í•„í„°
          const matchesSearch = query === '' || text.indexOf(query) > -1;
          
          // íŒŒì¼ íƒ€ì… í•„í„°
          let matchesType = true;
          if (fileTypeFilter !== 'all') {
            if (fileTypeFilter === 'png' && !filePath.toLowerCase().endsWith('.png') && 
                !filePath.toLowerCase().endsWith('.jpg') && 
                !filePath.toLowerCase().endsWith('.jpeg') && 
                !filePath.toLowerCase().endsWith('.gif')) {
              matchesType = false;
            } else if (fileTypeFilter === 'bin' && !filePath.toLowerCase().endsWith('.bin')) {
              matchesType = false;
            } else if (fileTypeFilter === 'other' && 
                      (filePath.toLowerCase().endsWith('.png') || 
                       filePath.toLowerCase().endsWith('.jpg') || 
                       filePath.toLowerCase().endsWith('.jpeg') || 
                       filePath.toLowerCase().endsWith('.gif') || 
                       filePath.toLowerCase().endsWith('.bin'))) {
              matchesType = false;
            }
          }
          
          // ë‘ í•„í„° ëª¨ë‘ ì ìš©
          if(matchesSearch && matchesType){
            items[i].style.display = "";
          } else {
            items[i].style.display = "none";
          }
        }
      });
    }
    
    // íŒŒì¼ íƒ€ì… í•„í„° ë³€ê²½ ì´ë²¤íŠ¸
    document.getElementById('file-type-filter').addEventListener('change', filterResults);
    
    /**********************
     * ì •ë ¬ ê¸°ëŠ¥
     **********************/
    document.querySelectorAll('.sort-btn').forEach(btn => {
      btn.addEventListener('click', function() {
        const sortType = this.dataset.sort;
        const listId = this.dataset.list;
        sortResultList(listId, sortType);
      });
    });
    
    function sortResultList(listId, sortType) {
      const list = document.getElementById(listId);
      const items = Array.from(list.children);
      
      items.sort((a, b) => {
        if (sortType === 'name') {
          // íŒŒì¼ëª… ê¸°ì¤€ ì •ë ¬
          const categoryA = a.dataset.category;
          const categoryB = b.dataset.category;
          const indexA = parseInt(a.dataset.index);
          const indexB = parseInt(b.dataset.index);
          
          const fileNameA = categoryData[categoryA][indexA];
          const fileNameB = categoryData[categoryB][indexB];
          
          return fileNameA.localeCompare(fileNameB);
        } else if (sortType === 'size') {
          // íŒŒì¼ í¬ê¸° ê¸°ì¤€ ì •ë ¬
          const categoryA = a.dataset.category;
          const categoryB = b.dataset.category;
          const indexA = parseInt(a.dataset.index);
          const indexB = parseInt(b.dataset.index);
          
          const fileNameA = categoryData[categoryA][indexA];
          const fileNameB = categoryData[categoryB][indexB];
          
          let sizeA = 0, sizeB = 0;
          
          if (categoryA === 'changed' || categoryA === 'identical') {
            sizeA = fileBSizes[fileNameA]?.size || 0;
          } else if (categoryA === 'new') {
            sizeA = fileBSizes[fileNameA]?.size || 0;
          } else if (categoryA === 'deleted') {
            sizeA = fileASizes[fileNameA]?.size || 0;
          }
          
          if (categoryB === 'changed' || categoryB === 'identical') {
            sizeB = fileBSizes[fileNameB]?.size || 0;
          } else if (categoryB === 'new') {
            sizeB = fileBSizes[fileNameB]?.size || 0;
          } else if (categoryB === 'deleted') {
            sizeB = fileASizes[fileNameB]?.size || 0;
          }
          
          return sizeB - sizeA;  // í° ê²ƒë¶€í„° ì •ë ¬
        }
        return 0;
      });
      
      // ì •ë ¬ëœ í•­ëª© ë‹¤ì‹œ ì¶”ê°€
      items.forEach(item => list.appendChild(item));
    }
    
    /**********************
     * ê²°ê³¼ ë‚´ë³´ë‚´ê¸° ê¸°ëŠ¥
     **********************/
    document.getElementById('export-btn').addEventListener('click', exportResults);
    
    function exportResults() {
      // ê²°ê³¼ ê°ì²´ ìƒì„±
      const results = {
        timestamp: new Date().toISOString(),
        comparison: {
          total: {
            fileA: Object.keys(fileASizes).length,
            fileB: Object.keys(fileBSizes).length
          },
          categories: {
            changed: categoryData.changed.length,
            new: categoryData.new.length,
            deleted: categoryData.deleted.length,
            identical: categoryData.identical.length
          }
        },
        files: {
          changed: categoryData.changed.map(file => ({
            path: file,
            sizeA: fileASizes[file]?.size || 0,
            sizeB: fileBSizes[file]?.size || 0,
            diff: Math.abs((fileASizes[file]?.size || 0) - (fileBSizes[file]?.size || 0))
          })),
          new: categoryData.new.map(file => ({
            path: file,
            size: fileBSizes[file]?.size || 0
          })),
          deleted: categoryData.deleted.map(file => ({
            path: file,
            size: fileASizes[file]?.size || 0
          })),
          identical: categoryData.identical.map(file => ({
            path: file,
            size: fileASizes[file]?.size || 0
          }))
        }
      };
      
      // JSON íŒŒì¼ë¡œ ë‹¤ìš´ë¡œë“œ
      const blob = new Blob([JSON.stringify(results, null, 2)], {type: 'application/json'});
      const url = URL.createObjectURL(blob);
      
      const a = document.createElement('a');
      a.href = url;
      a.download = `file-comparison-results-${new Date().toISOString().slice(0,10)}.json`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      
      showAlert('success', 'ë¹„êµ ê²°ê³¼ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
    }
    
    /**********************
     * ë‹¤í¬ ëª¨ë“œ í† ê¸€
     **********************/
    const themeToggle = document.getElementById('theme-toggle');
    
    themeToggle.addEventListener('click', toggleDarkMode);
    
    function toggleDarkMode() {
      document.body.classList.toggle('dark-mode');
      localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }
    
    // ì´ì „ ë‹¤í¬ ëª¨ë“œ ì„¤ì • ë³µì›
    document.addEventListener('DOMContentLoaded', function() {
      if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
      }
    });
    
    /**********************
     * íŒì—… ë° ì¢Œìš° ì´ë™ ê¸°ëŠ¥ (ê±´ë„ˆë›°ê¸° í¬í•¨)
     **********************/
    const popup = document.getElementById('popup');
    const popupCategoryLabel = document.getElementById('popup-category-label');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const previewA = document.getElementById('previewA-content');
    const previewB = document.getElementById('previewB-content');
    
    // ì´ë²¤íŠ¸ ìœ„ì„ ì ìš©
    document.addEventListener('DOMContentLoaded', function() {
      // ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ì— ì´ë²¤íŠ¸ ìœ„ì„ ì ìš©
      ['changedList', 'newList', 'deletedList', 'identicalList'].forEach(listId => {
        document.getElementById(listId).addEventListener('click', (e) => {
          const li = e.target.closest('li');
          if (li) {
            const category = li.dataset.category;
            const index = parseInt(li.dataset.index);
            openPopup(category, index);
          }
        });
      });
    });
    
    // openPopup: ì„ íƒëœ ì¹´í…Œê³ ë¦¬ì™€ ì¸ë±ìŠ¤ë¥¼ ì €ì¥ í›„ renderPopup() í˜¸ì¶œ
    function openPopup(category, index) {
      currentPreviewCategory = category;
      currentPreviewIndex = index;
      renderPopup();
      popup.style.display = "block";
    }
    
    // renderPopup: í˜„ì¬ ì¹´í…Œê³ ë¦¬ì™€ ì¸ë±ìŠ¤ì— í•´ë‹¹í•˜ëŠ” íŒŒì¼ ì •ë³´ë¥¼ ë¯¸ë¦¬ë³´ê¸° ì˜ì—­ì— í‘œì‹œ
    function renderPopup() {
      previewA.innerHTML = "";
      previewB.innerHTML = "";
      
      const list = categoryData[currentPreviewCategory];
      if (!list || list.length === 0) return;
      const fileName = list[currentPreviewIndex];
      
      let dataA = null, dataB = null;
      if (currentPreviewCategory === "changed" || currentPreviewCategory === "identical") {
        dataA = fileASizes[fileName];
        dataB = fileBSizes[fileName];
      } else if (currentPreviewCategory === "new") {
        dataB = fileBSizes[fileName];
      } else if (currentPreviewCategory === "deleted") {
        dataA = fileASizes[fileName];
      }
      
      if(dataA) {
        if(dataA.type === "image") {
          const img = document.createElement('img');
          img.src = dataA.dataUrl;
          img.style.maxWidth = "100%";
          img.style.maxHeight = "80vh";
          previewA.appendChild(img);
        } else if(dataA.type === "text") {
          showTextContent(previewA, dataA.data, dataB?.data);
        } else {
          // ê¸°íƒ€ íŒŒì¼ íƒ€ì…ì¼ ê²½ìš°
          const typeInfo = document.createElement('div');
          typeInfo.textContent = `${fileName} (${formatFileSize(dataA.size)})`;
          typeInfo.style.fontWeight = 'bold';
          typeInfo.style.marginBottom = '10px';
          previewA.appendChild(typeInfo);
          
          const info = document.createElement('div');
          info.textContent = 'ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
          previewA.appendChild(info);
        }
      } else {
        // A íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° (ìƒˆë¡œìš´ íŒŒì¼)
        const info = document.createElement('div');
        info.textContent = 'íŒŒì¼ Aì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ìƒˆë¡œìš´ íŒŒì¼)';
        previewA.appendChild(info);
      }
      
      if(dataB) {
        if(dataB.type === "image") {
          const img = document.createElement('img');
          img.src = dataB.dataUrl;
          img.style.maxWidth = "100%";
          img.style.maxHeight = "80vh";
          previewB.appendChild(img);
        } else if(dataB.type === "text") {
          showTextContent(previewB, dataB.data, dataA?.data);
        } else {
          // ê¸°íƒ€ íŒŒì¼ íƒ€ì…ì¼ ê²½ìš°
          const typeInfo = document.createElement('div');
          typeInfo.textContent = `${fileName} (${formatFileSize(dataB.size)})`;
          typeInfo.style.fontWeight = 'bold';
          typeInfo.style.marginBottom = '10px';
          previewB.appendChild(typeInfo);
          
          const info = document.createElement('div');
          info.textContent = 'ë¯¸ë¦¬ë³´ê¸°ë¥¼ ì§€ì›í•˜ì§€ ì•ŠëŠ” íŒŒì¼ í˜•ì‹ì…ë‹ˆë‹¤.';
          previewB.appendChild(info);
        }
      } else {
        // B íŒŒì¼ì´ ì—†ëŠ” ê²½ìš° (ì‚­ì œëœ íŒŒì¼)
        const info = document.createElement('div');
        info.textContent = 'íŒŒì¼ Bì— ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. (ì‚­ì œëœ íŒŒì¼)';
        previewB.appendChild(info);
      }
      
      popupCategoryLabel.textContent = categoryNames[currentPreviewCategory] + " (" + (currentPreviewIndex+1) + " / " + categoryData[currentPreviewCategory].length + ")";
    }
    
    // í…ìŠ¤íŠ¸ ë‚´ìš© í‘œì‹œ (ì°¨ì´ì  í•˜ì´ë¼ì´íŠ¸)
    function showTextContent(container, data, compareData) {
      if (!data) return;
      
      const pre = document.createElement('pre');
      
      // ë‚´ìš© ë¹„êµê°€ í™œì„±í™”ë˜ê³  ë¹„êµ ëŒ€ìƒì´ ìˆìœ¼ë©´ ì°¨ì´ì  í•˜ì´ë¼ì´íŠ¸
      if (contentComparisonCheckbox.checked && compareData) {
        const diff = findDifferentLines(data, compareData);
        
        if (diff.isDifferent) {
          const lines = data.split('\n');
          let htmlContent = '';
          
          lines.forEach((line, idx) => {
            if (diff.diffLines.includes(idx)) {
              htmlContent += `<div class="line-diff">${escapeHtml(line)}</div>`;
            } else {
              htmlContent += `<div>${escapeHtml(line)}</div>`;
            }
          });
          
          pre.innerHTML = htmlContent;
        } else {
          pre.textContent = data;
        }
      } else {
        pre.textContent = data;
      }
      
      container.appendChild(pre);
    }
    
    // HTML íŠ¹ìˆ˜ë¬¸ì ì´ìŠ¤ì¼€ì´í”„
    function escapeHtml(text) {
      const map = {
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#039;'
      };
      return text.replace(/[&<>"']/g, function(m) { return map[m]; });
    }
    
    // ì¢Œìš° ì´ë™ í•¨ìˆ˜ (ê±´ë„ˆë›°ê¸° ê¸°ëŠ¥ í¬í•¨)
    function nextFile() {
      let list = categoryData[currentPreviewCategory];
      if (currentPreviewIndex < list.length - 1) {
        currentPreviewIndex++;
        renderPopup();
      } else {
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ë§ˆì§€ë§‰ì´ë©´ ë‹¤ìŒ ì¹´í…Œê³ ë¦¬ ì¤‘ ë‚´ìš© ìˆëŠ” ê³³ìœ¼ë¡œ ì´ë™
        let currentIndex = categoryOrder.indexOf(currentPreviewCategory);
        let found = false;
        for (let i = currentIndex + 1; i < categoryOrder.length; i++) {
          if (categoryData[categoryOrder[i]] && categoryData[categoryOrder[i]].length > 0) {
            currentPreviewCategory = categoryOrder[i];
            currentPreviewIndex = 0;
            found = true;
            break;
          }
        }
        if(found) {
          renderPopup();
        }
      }
    }
    
    function prevFile() {
      let list = categoryData[currentPreviewCategory];
      if (currentPreviewIndex > 0) {
        currentPreviewIndex--;
        renderPopup();
      } else {
        // í˜„ì¬ ì¹´í…Œê³ ë¦¬ ì²˜ìŒì´ë©´ ì´ì „ ì¹´í…Œê³ ë¦¬ ì¤‘ ë‚´ìš© ìˆëŠ” ê³³ìœ¼ë¡œ ì´ë™
        let currentIndex = categoryOrder.indexOf(currentPreviewCategory);
        let found = false;
        for (let i = currentIndex - 1; i >= 0; i--) {
          if (categoryData[categoryOrder[i]] && categoryData[categoryOrder[i]].length > 0) {
            currentPreviewCategory = categoryOrder[i];
            currentPreviewIndex = categoryData[categoryOrder[i]].length - 1;
            found = true;
            break;
          }
        }
        if(found) {
          renderPopup();
        }
      }
    }
    
    // ì¢Œì¸¡, ìš°ì¸¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
    prevBtn.addEventListener("click", prevFile);
    nextBtn.addEventListener("click", nextFile);
    
    // í‚¤ë³´ë“œ ì¢Œìš° í™”ì‚´í‘œ ì´ë²¤íŠ¸ (íŒì—…ì´ ì—´ë ¸ì„ ë•Œ)
    document.addEventListener("keydown", (event) => {
      if(popup.style.display === "block") {
        if(event.key === "ArrowLeft") {
          prevFile();
        } else if(event.key === "ArrowRight") {
          nextFile();
        } else if(event.key === "Escape") {
          popup.style.display = "none";
        }
      }
    });
    
    // íŒì—… ë‹«ê¸° ì²˜ë¦¬
    const close = document.querySelector('.close');
    close.onclick = function() {
      popup.style.display = "none";
    }
    window.onclick = function(event) {
      if (event.target == popup) {
        popup.style.display = "none";
      }
    }
  </script>
</body>
</html>